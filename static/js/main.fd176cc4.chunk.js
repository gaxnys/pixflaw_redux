(this.webpackJsonppixflaw_redux=this.webpackJsonppixflaw_redux||[]).push([[0],{10:function(e,t,a){e.exports=a(13)},11:function(e,t,a){},13:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(8),i=a(7),o=(a(11),function(e,t,a){return{type:"TOUCHES",touches:e,windowWidth:t,windowHeight:a}}),s={ACCELERATION:.3,JUMP_ACCELERATION:3,RUN_ACCELERATION:.1,VELOCITY_LOSS:10,PLANET_MASS:4e5,PLAYER_WIDTH:20,PLAYER_HEIGHT:30,PLATFORM_SIDE:40,SPEED_LIMIT:10,DOWN_CONSTANT:.1,POINTS:2e4,BACKGROUND_RADIUS:4e3,LEVEL_RADIUS:4e3,PLANET_RADIUS:3e3,PLATFORMS:1e3,CAMERA_INERTIA:20,TOUCH_DEBOUNCE_LIMIT:10};s.FLY_ACCELERATION=s.RUN_ACCELERATION/2,s.GROUND_FRICTION=s.RUN_ACCELERATION/2,s.AIR_FRICTION=s.GROUND_FRICTION/2;var l=s,h={w:"up",ArrowUp:"up",a:"left",ArrowLeft:"left",s:"down",ArrowDown:"down",d:"right",ArrowRight:"right"," ":"up"},c=function(e,t,a){var r=0,i=a?0:-l.DOWN_CONSTANT,o=0,s=l.FLY_ACCELERATION;a?(o=l.JUMP_ACCELERATION,s=l.RUN_ACCELERATION):o=l.DOWN_CONSTANT;var h,c=Object(n.a)(e);try{for(c.s();!(h=c.n()).done;){switch(h.value){case"up":i+=o;break;case"left":r+=Math.atan(s/t);break;case"right":r-=Math.atan(s/t)}}}catch(u){c.e(u)}finally{c.f()}return{r:i-=l.PLANET_MASS/Math.pow(t,2),angle:r}},u=function(e,t,a){var r,i,o={up:!1,left:!1,down:!1,right:!1,almost:!1},s=l.PLAYER_WIDTH/2+l.PLATFORM_SIDE/2,h=Math.atan(s/e),c=l.PLAYER_HEIGHT/2+l.PLATFORM_SIDE/2,u=Object(n.a)(a);try{for(u.s();!(r=u.n()).done;){var d=r.value,p=d.r-e,v=(i=d.angle-t)>Math.PI?i-2*Math.PI:i<-Math.PI?i+2*Math.PI:i;o.almost=o.almost||Math.abs(p)<c+1&&Math.abs(v)<Math.atan((s-3)/e)&&p<0,Math.abs(p)>c||(Math.abs(v)>h||(c-Math.abs(p)<s-Math.abs(e*Math.tan(v))?p>=0?o.up=o.up||Math.abs(p)-c:o.down=o.down||c-Math.abs(p):v>=0?o.left=o.left||Math.abs(v)-h:o.right=o.right||h-Math.abs(v)))}}catch(E){u.e(E)}finally{u.f()}return o},d=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{keys:new Set,velR:0,velAngle:0,posR:3100,posAngle:Math.PI/2,cameraR:3100,cameraAngle:Math.PI/2,debounce:0},a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;switch(a.type){case"KEY_DOWN":return(e=new Set(t.keys)).add(h[a.key]),Object.assign({},t,{keys:e});case"KEY_UP":return(e=new Set(t.keys)).delete(h[a.key]),Object.assign({},t,{keys:e});case"TOUCHES":return e=new Set,2===a.touches.length?(t.debounce===l.TOUCH_DEBOUNCE_LIMIT&&(e=new Set(t.keys)),e.add("up")):a.touches.length>0&&(t.keys.has("up")&&e.add("up"),a.touches[0].clientX>a.windowWidth/2?e.add("right"):e.add("left")),Object.assign({},t,{keys:e});case"GAME_TICK":var r=u(t.posR,t.posAngle,n.level),i=t.posR-l.PLAYER_HEIGHT/2-1<n.planetRadius||r.almost,o=c(t.keys,t.posR,i),s=Math.min(t.velR+o.r,l.SPEED_LIMIT);(r.up&&t.velR>0||r.down&&t.velR<0)&&(s=0);var d=t.posR+s+r.down+r.up;t.posR-l.PLAYER_HEIGHT/2<n.planetRadius&&(d=n.planetRadius+l.PLAYER_HEIGHT/2,s=s<-l.VELOCITY_LOSS?-(s+l.VELOCITY_LOSS):0,s=0);var p=i?l.GROUND_FRICTION:l.AIR_FRICTION,v=t.velAngle+o.angle,E=Math.sign(-t.velAngle)*p;v+=Math.tan(E/t.posR),Math.abs(v)<Math.tan(p/t.posR)&&(v=0),(r.left&&t.velAngle>0||r.right&&t.velAngle<0)&&(v=0);var R=t.posAngle+v+r.left+r.right;R>2*Math.PI?R-=2*Math.PI:R<0&&(R+=2*Math.PI);var A=(t.cameraR*l.CAMERA_INERTIA+d)/(l.CAMERA_INERTIA+1),I=R-t.cameraAngle;I>Math.PI?I-=2*Math.PI:I<-Math.PI&&(I+=2*Math.PI);var f=t.cameraAngle+I/l.CAMERA_INERTIA;f>2*Math.PI?f-=2*Math.PI:f<0&&(f+=2*Math.PI);var g=t.debounce;return 0===t.keys.size?g=0:t.debounce<l.TOUCH_DEBOUNCE_LIMIT&&(g+=1),Object.assign({},t,{velAngle:v,velR:s,posAngle:R,posR:d,cameraAngle:f,cameraR:A,debounce:g});case"LEVEL_WIN":return Object.assign({},t,{posR:l.PLANET_RADIUS,cameraR:l.PLANET_RADIUS});default:return t}},p=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=[];o.length<e;){var s,l=2*Math.random()*Math.PI,h=(s=i?Math.random()+Math.random():Math.pow(Math.random(),3))>1?2-s:s,c=h*(t-a)+a;if(c>a){var u=Math.round(c*Math.cos(l)),d=Math.round(c*Math.sin(l)),p=!0;if(r>0){var v,E=Object(n.a)(o);try{for(E.s();!(v=E.n()).done;){var R=v.value;if(Math.abs(R.posX-u)+Math.abs(R.posY-d)<r){p=!1;break}}}catch(A){E.e(A)}finally{E.f()}}p&&o.push({angle:l,r:c,posX:u,posY:d})}}return o},v=function(e){return l.PLANET_RADIUS},E=function(e){return l.LEVEL_RADIUS*Math.pow(1.5,e)},R=function(e){return p(l.PLATFORMS,E(e),v(),60,!1)},A={level:R(0),wins:0,planetRadius:v(),goalRadius:E(0)},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.assign({},A),t=arguments.length>1?arguments[1]:void 0,a=e.wins;return"LEVEL_WIN"===t.type&&(a+=1),"LEVEL_WIN"===t.type||"RESET_LEVEL"===t.type?Object.assign({},e,{level:R(a),wins:a,planetRadius:v(),goalRadius:E(a)}):e},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GAME_TICK":return{player:d(e.player,t,e.level),level:I(e.level,t)};default:return{player:d(e.player,t),level:I(e.level,t)}}},g=a(1),y=a(2),_=a(4),L=a(3),T=function(){function e(t){Object(g.a)(this,e),this.context=document.createElement("canvas").getContext("2d"),this.getState=t,this.currentValue=void 0,this.updateCanvas=!1,this.updatePosition=!1}return Object(y.a)(e,[{key:"shouldComponentUpdate",value:function(){var e=this.currentValue;return this.currentValue=this.getState(),this.updateCanvas=this.shouldCanvasUpdate(e,this.currentValue),this.updatePosition=this.shouldPositionUpdate(e,this.currentValue),this.updateCanvas||this.updatePosition}},{key:"shouldCanvasUpdate",value:function(e,t){return this.updateCanvas=e!==t}},{key:"shouldPositionUpdate",value:function(e,t){return this.updatePosition=e!==t}},{key:"render",value:function(){throw new Error("Component class shall not be instantiated directly")}}]),e}(),M=function(e){Object(_.a)(a,e);var t=Object(L.a)(a);function a(){return Object(g.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"shouldCanvasUpdate",value:function(e,t){return void 0===e||(this.updateCanvas=e.player.posAngle!==t.player.posAngle||e.player.posR!==t.player.posR)}},{key:"shouldPositionUpdate",value:function(e,t){return void 0===e||(this.updatePosition=e.player.posAngle!==t.player.posAngle||e.player.posR!==t.player.posR||e.player.cameraAngle!==t.player.cameraAngle||e.player.cameraR!==t.player.cameraR)}},{key:"render",value:function(){var e=this.getState();if(this.updateCanvas){this.context.fillStyle="#007DFF";var t=this.context.canvas;this.context.clearRect(0,0,t.width,t.height),this.context.save(),this.context.translate(2*l.PLAYER_WIDTH,2*l.PLAYER_HEIGHT),this.context.rotate(e.player.posAngle),this.context.fillRect(-l.PLAYER_HEIGHT/2,-l.PLAYER_WIDTH/2,l.PLAYER_HEIGHT,l.PLAYER_WIDTH),this.context.restore()}return{canvas:this.context.canvas,angle:e.player.posAngle,r:e.player.posR,offsetX:2*l.PLAYER_WIDTH,offsetY:2*l.PLAYER_HEIGHT}}},{key:"renderToContext",value:function(e,t,a){var n=t.level.wins;e.save(),e.fillStyle="#007DFF",e.rotate(t.player.posAngle),e.translate(t.player.posR*a,0),e.fillRect(-l.PLAYER_HEIGHT/2*a,-l.PLAYER_WIDTH/2*a,l.PLAYER_HEIGHT*a,l.PLAYER_WIDTH*a),e.fillStyle="#FFFFFF";for(var r=0;r<n;r++){var i=Math.floor(r/2+1),o=Math.floor(r%2+1);e.fillRect(-(l.PLAYER_HEIGHT/2-l.PLAYER_HEIGHT/4*i+2)*a,-(l.PLAYER_WIDTH/2-l.PLAYER_WIDTH/3*o+2)*a,4*a,4*a)}e.restore()}}]),a}(T);var w,P,O=[function(e){Object(_.a)(a,e);var t=Object(L.a)(a);function a(e){var n;Object(g.a)(this,a),(n=t.call(this,e)).context.canvas.width=2*l.LEVEL_RADIUS+100,n.context.canvas.height=2*l.LEVEL_RADIUS+100,n.center=l.LEVEL_RADIUS+50;n.points=p(1e3,l.PLANET_RADIUS-5),n.randoms=[];for(var r=0;r<n.points.length;r++)n.randoms.push(Math.random());return n.context.canvas.width=100,n.context.canvas.height=100,n}return Object(y.a)(a,[{key:"shouldCanvasUpdate",value:function(e,t){return this.updateCanvas=!1}},{key:"shouldPositionUpdate",value:function(e,t){return this.updatePosition=!1}},{key:"render",value:function(){return{canvas:this.context.canvas,angle:0,r:0,offsetX:this.center,offsetY:this.center}}},{key:"renderToContext",value:function(e,t,a){!function(e,t,a){e.fillStyle="#999999";var r,i=Object(n.a)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;e.save(),e.rotate(o.angle),e.fillRect((o.r-l.PLATFORM_SIDE/2)*a,-l.PLATFORM_SIDE/2*a,l.PLATFORM_SIDE*a,l.PLATFORM_SIDE*a),e.restore()}}catch(s){i.e(s)}finally{i.f()}}(e,t.level.level,a),e.fillStyle="#666666",e.beginPath(),e.arc(0,0,t.level.planetRadius*a,0,2*Math.PI),e.fill(),e.strokeStyle="#00FF00",e.lineWidth=10,e.beginPath(),e.arc(0,0,t.level.goalRadius*a,0,2*Math.PI),e.stroke();for(var r=0;r<this.points.length;r++){var i=this.points[r],o=this.randoms[r];e.fillStyle="hsl(0, 0%, "+Math.round(100*o)+"%)",e.fillRect(i.posX*a,i.posY*a,5*a,5*a)}}}]),a}(T),M],C=1,S=function(){var e=document.getElementById("root"),t=document.createElement("canvas");return t.width=window.innerWidth,t.height=window.innerHeight,C=Math.min(t.width/1920,t.height/1080),window.onresize=function(e){t.width=window.innerWidth,t.height=window.innerHeight,C=Math.min(t.width/1920,t.height/1080)},e.appendChild(t),t.getContext("2d")}();Object(i.createLogger)({predicate:function(e,t){return"RENDER_TICK"!==t.type&&"GAME_TICK"!==t.type}});P=Object(r.a)(f);var b,N,D=O.map((function(e){return new e(P.getState)})),H=(b=P.getState,N=S,function(){var e=w;if((w=b())!==e&&D.reduce((function(e,t){return e||t.shouldComponentUpdate()}),!1)){N.fillStyle="#000",N.fillRect(0,0,N.canvas.width,N.canvas.height),N.save();var t=N.canvas;N.translate(t.width/2,t.height/2),N.scale(1,-1),N.translate(0,-w.player.cameraR*C);var a=-w.player.cameraAngle+Math.PI/2;N.rotate(a);var r,i=Object(n.a)(D);try{for(i.s();!(r=i.n()).done;)r.value.renderToContext(N,w,C)}catch(o){i.e(o)}finally{i.f()}N.restore()}});window.requestAnimationFrame((function e(t){H(),window.requestAnimationFrame(e)})),window.setInterval((function(){var e,t=P.getState();t.player.posR>t.level.goalRadius&&P.dispatch({type:"LEVEL_WIN"}),P.dispatch({type:"GAME_TICK",scale:e})}),10),window.onkeydown=function(e){"r"===e.key&&P.dispatch({type:"RESET_LEVEL"}),P.dispatch({type:"KEY_DOWN",key:e.key})},window.onkeyup=function(e){return P.dispatch({type:"KEY_UP",key:e.key})},document.body.addEventListener("touchstart",(function(e){e.preventDefault(),P.dispatch(o(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchend",(function(e){e.preventDefault(),P.dispatch(o(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchcancel",(function(e){e.preventDefault(),P.dispatch(o(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1})}},[[10,1,2]]]);
//# sourceMappingURL=main.fd176cc4.chunk.js.map