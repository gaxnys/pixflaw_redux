(this.webpackJsonppixflaw_redux=this.webpackJsonppixflaw_redux||[]).push([[0],{13:function(t,e,a){t.exports=a(16)},14:function(t,e,a){},16:function(t,e,a){"use strict";a.r(e);var n=a(0),r=a(10),i=a(9),s=(a(14),function(t,e,a){return{type:"TOUCHES",touches:t,windowWidth:e,windowHeight:a}}),o={ACCELERATION:.3,JUMP_ACCELERATION:3,RUN_ACCELERATION:.1,VELOCITY_LOSS:10,PLANET_MASS:4e5,PLAYER_WIDTH:20,PLAYER_HEIGHT:30,PLATFORM_SIDE:40,SPEED_LIMIT:10,DOWN_CONSTANT:.1,POINTS:2e4,BACKGROUND_RADIUS:4e3,LEVEL_RADIUS:4e3,PLANET_RADIUS:3e3,PLATFORMS:1e3,CAMERA_INERTIA:20,TOUCH_DEBOUNCE_LIMIT:10};o.FLY_ACCELERATION=o.RUN_ACCELERATION/2,o.GROUND_FRICTION=o.RUN_ACCELERATION/2,o.AIR_FRICTION=o.GROUND_FRICTION/2;var l=o,h={w:"up",ArrowUp:"up",a:"left",ArrowLeft:"left",s:"down",ArrowDown:"down",d:"right",ArrowRight:"right"," ":"up"},u=function(t,e,a){var r=0,i=a?0:-l.DOWN_CONSTANT,s=0,o=l.FLY_ACCELERATION;a?(s=l.JUMP_ACCELERATION,o=l.RUN_ACCELERATION):s=l.DOWN_CONSTANT;var h,u=Object(n.a)(t);try{for(u.s();!(h=u.n()).done;){switch(h.value){case"up":i+=s;break;case"left":r+=Math.atan(o/e);break;case"right":r-=Math.atan(o/e)}}}catch(c){u.e(c)}finally{u.f()}return{r:i-=l.PLANET_MASS/Math.pow(e,2),angle:r}},c=function(t,e,a){var r,i,s={up:!1,left:!1,down:!1,right:!1,almost:!1},o=l.PLAYER_WIDTH/2+l.PLATFORM_SIDE/2,h=Math.atan(o/t),u=l.PLAYER_HEIGHT/2+l.PLATFORM_SIDE/2,c=Object(n.a)(a);try{for(c.s();!(r=c.n()).done;){var d=r.value,p=d.getRadius()-t,v=(i=d.getAngle()-e)>Math.PI?i-2*Math.PI:i<-Math.PI?i+2*Math.PI:i;s.almost=s.almost||Math.abs(p)<u+1&&Math.abs(v)<Math.atan((o-3)/t)&&p<0,Math.abs(p)>u||(Math.abs(v)>h||(u-Math.abs(p)<o-Math.abs(t*Math.tan(v))?p>=0?s.up=s.up||Math.abs(p)-u:s.down=s.down||u-Math.abs(p):v>=0?s.left=s.left||Math.abs(v)-h:s.right=s.right||h-Math.abs(v)))}}catch(E){c.e(E)}finally{c.f()}return s},d=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{keys:new Set,velR:0,velAngle:0,posR:3100,posAngle:Math.PI/2,cameraR:3100,cameraAngle:Math.PI/2,debounce:0},a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;switch(a.type){case"KEY_DOWN":return(t=new Set(e.keys)).add(h[a.key]),Object.assign({},e,{keys:t});case"KEY_UP":return(t=new Set(e.keys)).delete(h[a.key]),Object.assign({},e,{keys:t});case"TOUCHES":return t=new Set,2===a.touches.length?(e.debounce===l.TOUCH_DEBOUNCE_LIMIT&&(t=new Set(e.keys)),t.add("up")):a.touches.length>0&&(e.keys.has("up")&&t.add("up"),a.touches[0].clientX>a.windowWidth/2?t.add("right"):t.add("left")),Object.assign({},e,{keys:t});case"GAME_TICK":var r=c(e.posR,e.posAngle,n.level),i=e.posR-l.PLAYER_HEIGHT/2-1<n.planetRadius||r.almost,s=u(e.keys,e.posR,i),o=Math.min(e.velR+s.r,l.SPEED_LIMIT);(r.up&&e.velR>0||r.down&&e.velR<0)&&(o=0);var d=e.posR+o+r.down+r.up;e.posR-l.PLAYER_HEIGHT/2<n.planetRadius&&(d=n.planetRadius+l.PLAYER_HEIGHT/2,o=o<-l.VELOCITY_LOSS?-(o+l.VELOCITY_LOSS):0,o=0);var p=i?l.GROUND_FRICTION:l.AIR_FRICTION,v=e.velAngle+s.angle,E=Math.sign(-e.velAngle)*p;v+=Math.tan(E/e.posR),Math.abs(v)<Math.tan(p/e.posR)&&(v=0),(r.left&&e.velAngle>0||r.right&&e.velAngle<0)&&(v=0);var R=e.posAngle+v+r.left+r.right;R>2*Math.PI?R-=2*Math.PI:R<0&&(R+=2*Math.PI);var A=(e.cameraR*l.CAMERA_INERTIA+d)/(l.CAMERA_INERTIA+1),f=R-e.cameraAngle;f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI);var g=e.cameraAngle+f/l.CAMERA_INERTIA;g>2*Math.PI?g-=2*Math.PI:g<0&&(g+=2*Math.PI);var I=e.debounce;return 0===e.keys.size?I=0:e.debounce<l.TOUCH_DEBOUNCE_LIMIT&&(I+=1),Object.assign({},e,{velAngle:v,velR:o,posAngle:R,posR:d,cameraAngle:g,cameraR:A,debounce:I});case"LEVEL_WIN":return Object.assign({},e,{posR:l.PLANET_RADIUS,cameraR:l.PLANET_RADIUS});default:return e}},p=a(12),v=a(1),E=a(2),R=function(){function t(e,a){Object(v.a)(this,t),this.angle=e,this.radius=a}return Object(E.a)(t,[{key:"getAngle",value:function(){return this.angle}},{key:"getRadius",value:function(){return this.radius}},{key:"getX",value:function(){return void 0===this.posX&&(this.posX=Math.round(this.radius*Math.cos(this.angle))),this.posX}},{key:"getY",value:function(){return void 0===this.posY&&(this.posY=Math.round(this.radius*Math.sin(this.angle))),this.posY}}]),t}(),A=function(t){var e=l.PLANET_MASS/Math.pow(t.getRadius(),2),a=l.JUMP_ACCELERATION,n=l.FLY_ACCELERATION*Math.pow(f(a,e),2)/3,r=Math.atan(n/t.getRadius()),i=Math.pow(Math.random(),4)*Math.sign(Math.random()-.5),s=Math.random();return new R(t.getAngle()+r*i,t.getRadius()+g(a,e,i)*s)},f=function(t,e){return 2*t/e},g=function(t,e,a){var n=function(t,e){return Math.pow(t,2)/(2*e)}(t,e);return Math.abs(a)<.5?n:n*(1-2*(Math.abs(a)-.5))},I=function(t){return l.PLANET_RADIUS},y=function(t){return l.LEVEL_RADIUS*Math.pow(1.5,t)},M=function(t){for(var e=y(t),a=[],n=0;n<42;n++){var r=new R(Math.random()*Math.PI*2,l.PLANET_RADIUS+20);L(r,a)&&a.push.apply(a,Object(p.a)(_(r,e,a)))}return a},_=function(t,e,a){for(var n=[t],r=t;;){var i=A(r);if(i.getRadius()>=e)break;L(i,n)&&L(i,a)&&(n.push(i),r=i)}return n},L=function(t,e){var a,r=Object(n.a)(e);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(Math.abs(i.getX()-t.getX())+Math.abs(i.getY()-t.getY())<100)return!1}}catch(s){r.e(s)}finally{r.f()}return!0},T={level:M(0),wins:0,planetRadius:I(),goalRadius:y(0)},w=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.assign({},T),e=arguments.length>1?arguments[1]:void 0,a=t.wins;return"LEVEL_WIN"===e.type&&(a+=1),"LEVEL_WIN"===e.type||"RESET_LEVEL"===e.type?Object.assign({},t,{level:M(a),wins:a,planetRadius:I(),goalRadius:y(a)}):t},P=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;switch(e.type){case"GAME_TICK":return{player:d(t.player,e,t.level),level:w(t.level,e)};default:return{player:d(t.player,e),level:w(t.level,e)}}},O=a(6),C=a(5),b=function(){function t(e){Object(v.a)(this,t),this.context=document.createElement("canvas").getContext("2d"),this.getState=e,this.currentValue=void 0,this.updateCanvas=!1,this.updatePosition=!1}return Object(E.a)(t,[{key:"shouldComponentUpdate",value:function(){var t=this.currentValue;return this.currentValue=this.getState(),this.updateCanvas=this.shouldCanvasUpdate(t,this.currentValue),this.updatePosition=this.shouldPositionUpdate(t,this.currentValue),this.updateCanvas||this.updatePosition}},{key:"shouldCanvasUpdate",value:function(t,e){return this.updateCanvas=t!==e}},{key:"shouldPositionUpdate",value:function(t,e){return this.updatePosition=t!==e}},{key:"render",value:function(){throw new Error("Component class shall not be instantiated directly")}}]),t}(),S=function(t){Object(O.a)(a,t);var e=Object(C.a)(a);function a(){return Object(v.a)(this,a),e.apply(this,arguments)}return Object(E.a)(a,[{key:"shouldCanvasUpdate",value:function(t,e){return void 0===t||(this.updateCanvas=t.player.posAngle!==e.player.posAngle||t.player.posR!==e.player.posR)}},{key:"shouldPositionUpdate",value:function(t,e){return void 0===t||(this.updatePosition=t.player.posAngle!==e.player.posAngle||t.player.posR!==e.player.posR||t.player.cameraAngle!==e.player.cameraAngle||t.player.cameraR!==e.player.cameraR)}},{key:"render",value:function(){var t=this.getState();if(this.updateCanvas){this.context.fillStyle="#007DFF";var e=this.context.canvas;this.context.clearRect(0,0,e.width,e.height),this.context.save(),this.context.translate(2*l.PLAYER_WIDTH,2*l.PLAYER_HEIGHT),this.context.rotate(t.player.posAngle),this.context.fillRect(-l.PLAYER_HEIGHT/2,-l.PLAYER_WIDTH/2,l.PLAYER_HEIGHT,l.PLAYER_WIDTH),this.context.restore()}return{canvas:this.context.canvas,angle:t.player.posAngle,r:t.player.posR,offsetX:2*l.PLAYER_WIDTH,offsetY:2*l.PLAYER_HEIGHT}}},{key:"renderToContext",value:function(t,e,a){var n=e.level.wins;t.save(),t.fillStyle="#007DFF",t.rotate(e.player.posAngle),t.translate(e.player.posR*a,0),t.fillRect(-l.PLAYER_HEIGHT/2*a,-l.PLAYER_WIDTH/2*a,l.PLAYER_HEIGHT*a,l.PLAYER_WIDTH*a),t.fillStyle="#FFFFFF";for(var r=0;r<n;r++){var i=Math.floor(r/2+1),s=Math.floor(r%2+1);t.fillRect(-(l.PLAYER_HEIGHT/2-l.PLAYER_HEIGHT/4*i+2)*a,-(l.PLAYER_WIDTH/2-l.PLAYER_WIDTH/3*s+2)*a,4*a,4*a)}t.restore()}}]),a}(b);var N,D,m=[function(t){Object(O.a)(a,t);var e=Object(C.a)(a);function a(t){var r;Object(v.a)(this,a),(r=e.call(this,t)).context.canvas.width=2*l.LEVEL_RADIUS+100,r.context.canvas.height=2*l.LEVEL_RADIUS+100,r.center=l.LEVEL_RADIUS+50;r.points=function(t,e){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=[];i.length<t;){var s=2*Math.random()*Math.PI,o=Math.random(),l=o>1?2-o:o,h=l*(e-a)+a;if(h>a){var u=new R(s,h),c=!0;if(r>0){var d,p=Object(n.a)(i);try{for(p.s();!(d=p.n()).done;){var v=d.value;if(Math.abs(v.getX()-u.getX())+Math.abs(v.getY()-u.getY())<r){c=!1;break}}}catch(E){p.e(E)}finally{p.f()}}c&&i.push(u)}}return i}(1e3,l.PLANET_RADIUS-5),r.randoms=[];for(var i=0;i<r.points.length;i++)r.randoms.push(Math.random());return r.context.canvas.width=100,r.context.canvas.height=100,r}return Object(E.a)(a,[{key:"shouldCanvasUpdate",value:function(t,e){return this.updateCanvas=!1}},{key:"shouldPositionUpdate",value:function(t,e){return this.updatePosition=!1}},{key:"render",value:function(){return{canvas:this.context.canvas,angle:0,r:0,offsetX:this.center,offsetY:this.center}}},{key:"renderToContext",value:function(t,e,a){!function(t,e,a){t.fillStyle="#999999";var r,i=Object(n.a)(e);try{for(i.s();!(r=i.n()).done;){var s=r.value;t.save(),t.rotate(s.angle),t.fillRect((s.getRadius()-l.PLATFORM_SIDE/2)*a,-l.PLATFORM_SIDE/2*a,l.PLATFORM_SIDE*a,l.PLATFORM_SIDE*a),t.restore()}}catch(o){i.e(o)}finally{i.f()}}(t,e.level.level,a),t.fillStyle="#666666",t.beginPath(),t.arc(0,0,e.level.planetRadius*a,0,2*Math.PI),t.fill(),t.strokeStyle="#00FF00",t.lineWidth=10,t.beginPath(),t.arc(0,0,e.level.goalRadius*a,0,2*Math.PI),t.stroke();for(var r=0;r<this.points.length;r++){var i=this.points[r],s=this.randoms[r];t.fillStyle="hsl(0, 0%, "+Math.round(100*s)+"%)",t.fillRect(i.getX()*a,i.getY()*a,5*a,5*a)}}}]),a}(b),S],H=1,U=function(){var t=document.getElementById("root"),e=document.createElement("canvas");return e.width=window.innerWidth,e.height=window.innerHeight,H=Math.min(e.width/1920,e.height/1080),window.onresize=function(t){e.width=window.innerWidth,e.height=window.innerHeight,H=Math.min(e.width/1920,e.height/1080)},t.appendChild(e),e.getContext("2d")}();Object(i.createLogger)({predicate:function(t,e){return"RENDER_TICK"!==e.type&&"GAME_TICK"!==e.type}});D=Object(r.a)(P);var Y,k,F=m.map((function(t){return new t(D.getState)})),j=(Y=D.getState,k=U,function(){var t=N;if((N=Y())!==t&&F.reduce((function(t,e){return t||e.shouldComponentUpdate()}),!1)){k.fillStyle="#000",k.fillRect(0,0,k.canvas.width,k.canvas.height),k.save();var e=k.canvas;k.translate(e.width/2,e.height/2),k.scale(1,-1),k.translate(0,-N.player.cameraR*H);var a=-N.player.cameraAngle+Math.PI/2;k.rotate(a);var r,i=Object(n.a)(F);try{for(i.s();!(r=i.n()).done;)r.value.renderToContext(k,N,H)}catch(s){i.e(s)}finally{i.f()}k.restore()}});window.requestAnimationFrame((function t(e){j(),window.requestAnimationFrame(t)})),window.setInterval((function(){var t,e=D.getState();e.player.posR>e.level.goalRadius&&D.dispatch({type:"LEVEL_WIN"}),D.dispatch({type:"GAME_TICK",scale:t})}),10),window.onkeydown=function(t){"r"===t.key&&D.dispatch({type:"RESET_LEVEL"}),D.dispatch({type:"KEY_DOWN",key:t.key})},window.onkeyup=function(t){return D.dispatch({type:"KEY_UP",key:t.key})},document.body.addEventListener("touchstart",(function(t){t.preventDefault(),D.dispatch(s(t.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchend",(function(t){t.preventDefault(),D.dispatch(s(t.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchcancel",(function(t){t.preventDefault(),D.dispatch(s(t.touches,window.innerWidth,window.innerHeight))}),{passive:!1})}},[[13,1,2]]]);
//# sourceMappingURL=main.7ac53ce5.chunk.js.map