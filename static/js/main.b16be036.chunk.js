(this.webpackJsonppixflaw_redux=this.webpackJsonppixflaw_redux||[]).push([[0],{10:function(e,t,a){e.exports=a(13)},11:function(e,t,a){},13:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a(8),o=a(7),i=(a(11),function(e,t,a){return{type:"TOUCHES",touches:e,windowWidth:t,windowHeight:a}}),s={ACCELERATION:.3,JUMP_ACCELERATION:3,RUN_ACCELERATION:.1,VELOCITY_LOSS:10,PLANET_MASS:4e5,PLAYER_WIDTH:20,PLAYER_HEIGHT:30,PLATFORM_SIDE:40,SPEED_LIMIT:10,DOWN_CONSTANT:.1,POINTS:2e4,BACKGROUND_RADIUS:4e3,LEVEL_RADIUS:4e3,PLANET_RADIUS:3e3,PLATFORMS:1e3,CAMERA_INERTIA:20,TOUCH_DEBOUNCE_LIMIT:10};s.FLY_ACCELERATION=s.RUN_ACCELERATION/2,s.GROUND_FRICTION=s.RUN_ACCELERATION/2,s.AIR_FRICTION=s.GROUND_FRICTION/2;var l,h,c=s,u={w:"up",ArrowUp:"up",a:"left",ArrowLeft:"left",s:"down",ArrowDown:"down",d:"right",ArrowRight:"right"," ":"up"},d=function(e,t,a){var r=0,o=a?0:-c.DOWN_CONSTANT,i=0,s=c.FLY_ACCELERATION;a?(i=c.JUMP_ACCELERATION,s=c.RUN_ACCELERATION):i=c.DOWN_CONSTANT;var l,h=Object(n.a)(e);try{for(h.s();!(l=h.n()).done;){switch(l.value){case"up":o+=i;break;case"left":r+=Math.atan(s/t);break;case"right":r-=Math.atan(s/t)}}}catch(u){h.e(u)}finally{h.f()}return{r:o-=c.PLANET_MASS/Math.pow(t,2),angle:r}},p=function(e,t,a){var r,o,i={up:!1,left:!1,down:!1,right:!1,almost:!1},s=c.PLAYER_WIDTH/2+c.PLATFORM_SIDE/2,l=Math.atan(s/e),h=c.PLAYER_HEIGHT/2+c.PLATFORM_SIDE/2,u=Object(n.a)(a);try{for(u.s();!(r=u.n()).done;){var d=r.value,p=d.r-e,v=(o=d.angle-t)>Math.PI?o-2*Math.PI:o<-Math.PI?o+2*Math.PI:o;i.almost=i.almost||Math.abs(p)<h+1&&Math.abs(v)<Math.atan((s-3)/e)&&p<0,Math.abs(p)>h||(Math.abs(v)>l||(h-Math.abs(p)<s-Math.abs(e*Math.tan(v))?p>=0?i.up=i.up||Math.abs(p)-h:i.down=i.down||h-Math.abs(p):v>=0?i.left=i.left||Math.abs(v)-l:i.right=i.right||l-Math.abs(v)))}}catch(E){u.e(E)}finally{u.f()}return i},v=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{keys:new Set,velR:0,velAngle:0,posR:3100,posAngle:Math.PI/2,cameraR:3100,cameraAngle:Math.PI/2,debounce:0},a=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;switch(a.type){case"KEY_DOWN":return(e=new Set(t.keys)).add(u[a.key]),Object.assign({},t,{keys:e});case"KEY_UP":return(e=new Set(t.keys)).delete(u[a.key]),Object.assign({},t,{keys:e});case"TOUCHES":return e=new Set,2===a.touches.length?(t.debounce===c.TOUCH_DEBOUNCE_LIMIT&&(e=new Set(t.keys)),e.add("up")):a.touches.length>0&&(t.keys.has("up")&&e.add("up"),a.touches[0].clientX>a.windowWidth/2?e.add("right"):e.add("left")),Object.assign({},t,{keys:e});case"GAME_TICK":var r=p(t.posR,t.posAngle,n.level),o=t.posR-c.PLAYER_HEIGHT/2-1<n.planetRadius||r.almost,i=d(t.keys,t.posR,o),s=Math.min(t.velR+i.r,c.SPEED_LIMIT);(r.up&&t.velR>0||r.down&&t.velR<0)&&(s=0);var l=t.posR+s+r.down+r.up;t.posR-c.PLAYER_HEIGHT/2<n.planetRadius&&(l=n.planetRadius+c.PLAYER_HEIGHT/2,s=s<-c.VELOCITY_LOSS?-(s+c.VELOCITY_LOSS):0,s=0);var h=o?c.GROUND_FRICTION:c.AIR_FRICTION,v=t.velAngle+i.angle,E=Math.sign(-t.velAngle)*h;v+=Math.tan(E/t.posR),Math.abs(v)<Math.tan(h/t.posR)&&(v=0),(r.left&&t.velAngle>0||r.right&&t.velAngle<0)&&(v=0);var R=t.posAngle+v+r.left+r.right;R>2*Math.PI?R-=2*Math.PI:R<0&&(R+=2*Math.PI);var A=(t.cameraR*c.CAMERA_INERTIA+l)/(c.CAMERA_INERTIA+1),f=R-t.cameraAngle;f>Math.PI?f-=2*Math.PI:f<-Math.PI&&(f+=2*Math.PI);var I=t.cameraAngle+f/c.CAMERA_INERTIA;I>2*Math.PI?I-=2*Math.PI:I<0&&(I+=2*Math.PI);var y=t.debounce;return 0===t.keys.size?y=0:t.debounce<c.TOUCH_DEBOUNCE_LIMIT&&(y+=1),Object.assign({},t,{velAngle:v,velR:s,posAngle:R,posR:l,cameraAngle:I,cameraR:A,debounce:y});case"LEVEL_WIN":return Object.assign({},t,{posR:c.PLANET_RADIUS,cameraR:c.PLANET_RADIUS});default:return t}},E=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=[];i.length<e;){var s,l=2*Math.random()*Math.PI,h=(s=o?Math.random()+Math.random():Math.pow(Math.random(),3))>1?2-s:s,c=h*(t-a)+a;if(c>a){var u=Math.round(c*Math.cos(l)),d=Math.round(c*Math.sin(l)),p=!0;if(r>0){var v,E=Object(n.a)(i);try{for(E.s();!(v=E.n()).done;){var R=v.value;if(Math.abs(R.posX-u)+Math.abs(R.posY-d)<r){p=!1;break}}}catch(A){E.e(A)}finally{E.f()}}p&&i.push({angle:l,r:c,posX:u,posY:d})}}return i},R=function(e){return c.PLANET_RADIUS},A=function(e){return c.LEVEL_RADIUS*Math.pow(1.5,e)},f=function(e){return E(c.PLATFORMS,A(e),R(),60,!1)},I={level:f(0),wins:0,planetRadius:R(),goalRadius:A(0)},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object.assign({},I),t=arguments.length>1?arguments[1]:void 0,a=e.wins;return"LEVEL_WIN"===t.type&&(a+=1),"LEVEL_WIN"===t.type||"RESET_LEVEL"===t.type?Object.assign({},e,{level:f(a),wins:a,planetRadius:R(),goalRadius:A(a)}):e},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GAME_TICK":return{player:v(e.player,t,e.level),level:y(e.level,t)};default:return{player:v(e.player,t),level:y(e.level,t)}}},_=a(1),T=a(2),L=a(4),M=a(3),P=function(){function e(t){Object(_.a)(this,e),this.context=document.createElement("canvas").getContext("2d"),this.getState=t,this.currentValue=void 0,this.updateCanvas=!1,this.updatePosition=!1}return Object(T.a)(e,[{key:"shouldComponentUpdate",value:function(){var e=this.currentValue;return this.currentValue=this.getState(),this.updateCanvas=this.shouldCanvasUpdate(e,this.currentValue),this.updatePosition=this.shouldPositionUpdate(e,this.currentValue),this.updateCanvas||this.updatePosition}},{key:"shouldCanvasUpdate",value:function(e,t){return this.updateCanvas=e!==t}},{key:"shouldPositionUpdate",value:function(e,t){return this.updatePosition=e!==t}},{key:"render",value:function(){throw new Error("Component class shall not be instantiated directly")}}]),e}(),w=function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(){return Object(_.a)(this,a),t.apply(this,arguments)}return Object(T.a)(a,[{key:"shouldCanvasUpdate",value:function(e,t){return void 0===e||(this.updateCanvas=e.player.posAngle!==t.player.posAngle||e.player.posR!==t.player.posR)}},{key:"shouldPositionUpdate",value:function(e,t){return void 0===e||(this.updatePosition=e.player.posAngle!==t.player.posAngle||e.player.posR!==t.player.posR||e.player.cameraAngle!==t.player.cameraAngle||e.player.cameraR!==t.player.cameraR)}},{key:"render",value:function(){var e=this.getState();if(this.updateCanvas){this.context.fillStyle="#007DFF";var t=this.context.canvas;this.context.clearRect(0,0,t.width,t.height),this.context.save(),this.context.translate(2*c.PLAYER_WIDTH,2*c.PLAYER_HEIGHT),this.context.rotate(e.player.posAngle),this.context.fillRect(-c.PLAYER_HEIGHT/2,-c.PLAYER_WIDTH/2,c.PLAYER_HEIGHT,c.PLAYER_WIDTH),this.context.restore()}return{canvas:this.context.canvas,angle:e.player.posAngle,r:e.player.posR,offsetX:2*c.PLAYER_WIDTH,offsetY:2*c.PLAYER_HEIGHT}}},{key:"renderToContext",value:function(e,t){var a=t.level.wins;e.save(),e.fillStyle="#007DFF",e.rotate(t.player.posAngle),e.translate(t.player.posR,0),e.fillRect(-c.PLAYER_HEIGHT/2,-c.PLAYER_WIDTH/2,c.PLAYER_HEIGHT,c.PLAYER_WIDTH),e.fillStyle="#FFFFFF";for(var n=0;n<a;n++){var r=Math.floor(n/2+1),o=Math.floor(n%2+1);e.fillRect(-c.PLAYER_HEIGHT/2+c.PLAYER_HEIGHT/4*r-2,-c.PLAYER_WIDTH/2+c.PLAYER_WIDTH/3*o-2,4,4)}e.restore()}}]),a}(P),O=function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;Object(_.a)(this,a),(n=t.call(this,e)).context.canvas.width=2*c.LEVEL_RADIUS+100,n.context.canvas.height=2*c.LEVEL_RADIUS+100,n.center=c.LEVEL_RADIUS+50;n.points=E(1e3,c.PLANET_RADIUS-5),n.randoms=[];for(var r=0;r<n.points.length;r++)n.randoms.push(Math.random());return n.context.canvas.width=100,n.context.canvas.height=100,n}return Object(T.a)(a,[{key:"shouldCanvasUpdate",value:function(e,t){return this.updateCanvas=!1}},{key:"shouldPositionUpdate",value:function(e,t){return this.updatePosition=!1}},{key:"render",value:function(){return{canvas:this.context.canvas,angle:0,r:0,offsetX:this.center,offsetY:this.center}}},{key:"renderToContext",value:function(e,t,a){e.fillStyle="#999999";var r,o=Object(n.a)(t.level.level);try{for(o.s();!(r=o.n()).done;){var i=r.value;e.save(),e.rotate(i.angle),e.fillRect(i.r-c.PLATFORM_SIDE/2,-c.PLATFORM_SIDE/2,c.PLATFORM_SIDE,c.PLATFORM_SIDE),e.restore()}}catch(u){o.e(u)}finally{o.f()}e.fillStyle="#666666",e.beginPath(),e.arc(a,a,t.level.planetRadius,0,2*Math.PI),e.fill(),e.strokeStyle="#00FF00",e.lineWidth=10,e.beginPath(),e.arc(a,a,t.level.goalRadius,0,2*Math.PI),e.stroke();for(var s=0;s<this.points.length;s++){var l=this.points[s],h=this.randoms[s];e.fillStyle="hsl(0, 0%, "+Math.round(100*h)+"%)",e.fillRect(a+l.posX,a+l.posY,5,5)}}}]),a}(P),C=[function(e){Object(L.a)(a,e);var t=Object(M.a)(a);function a(e){var n;return Object(_.a)(this,a),(n=t.call(this,e)).points=E(c.POINTS,c.BACKGROUND_RADIUS),n}return Object(T.a)(a,[{key:"shouldCanvasUpdate",value:function(e,t){return this.updateCanvas=!1}},{key:"shouldPositionUpdate",value:function(e,t){return this.updatePosition=!1}},{key:"renderToContext",value:function(e,t){e.fillStyle="#FFFFFF";var a,r=.9*t.player.cameraR-c.PLANET_RADIUS,o=t.player.cameraAngle,i=r*Math.cos(o),s=r*Math.sin(o),l=Object(n.a)(this.points);try{for(l.s();!(a=l.n()).done;){var h=a.value,u=Math.round(h.r*Math.cos(h.angle)+i),d=Math.round(h.r*Math.sin(h.angle)+s);e.fillRect(u,d,1,1)}}catch(p){l.e(p)}finally{l.f()}}}]),a}(P),O,w],S=function(){var e=document.getElementById("root"),t=document.createElement("canvas");return t.width=window.innerWidth,t.height=window.innerHeight,window.onresize=function(e){t.width=window.innerWidth,t.height=window.innerHeight},e.appendChild(t),t.getContext("2d")}();Object(o.createLogger)({predicate:function(e,t){return"RENDER_TICK"!==t.type&&"GAME_TICK"!==t.type}});h=Object(r.a)(g);var b,N,D=C.map((function(e){return new e(h.getState)})),H=(b=h.getState,N=S,function(){var e=l;if((l=b())!==e&&D.reduce((function(e,t){return e||t.shouldComponentUpdate()}),!1)){N.fillStyle="#000",N.fillRect(0,0,N.canvas.width,N.canvas.height),N.save();var t=N.canvas;N.translate(t.width/2,t.height/2),N.scale(1,-1),N.translate(0,-l.player.cameraR);var a=-l.player.cameraAngle+Math.PI/2;N.rotate(a);var r,o=Object(n.a)(D);try{for(o.s();!(r=o.n()).done;)r.value.renderToContext(N,l,0)}catch(i){o.e(i)}finally{o.f()}N.restore()}});window.requestAnimationFrame((function e(t){H(),window.requestAnimationFrame(e)})),window.setInterval((function(){var e,t=h.getState();t.player.posR>t.level.goalRadius&&h.dispatch({type:"LEVEL_WIN"}),h.dispatch({type:"GAME_TICK",scale:e})}),10),window.onkeydown=function(e){"r"===e.key&&h.dispatch({type:"RESET_LEVEL"}),h.dispatch({type:"KEY_DOWN",key:e.key})},window.onkeyup=function(e){return h.dispatch({type:"KEY_UP",key:e.key})},document.body.addEventListener("touchstart",(function(e){e.preventDefault(),h.dispatch(i(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchend",(function(e){e.preventDefault(),h.dispatch(i(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1}),document.body.addEventListener("touchcancel",(function(e){e.preventDefault(),h.dispatch(i(e.touches,window.innerWidth,window.innerHeight))}),{passive:!1})}},[[10,1,2]]]);
//# sourceMappingURL=main.b16be036.chunk.js.map